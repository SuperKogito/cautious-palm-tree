
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spafe.utils.levinsondr &#8212; üß† SuperKogito/Spafe 0.1.2 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_contributors.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/tree_graph.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/social_media_sharing.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-133660046-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../../index.html">
<p class="title">üß† SuperKogito/Spafe</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://superkogito.github.io/index.html">Home<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://superkogito.github.io/projects.html">Projects<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://superkogito.github.io/blog.html">Blog<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://superkogito.github.io/about.html">About Me<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../api.html">
  üìÑ API documentation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../exp.html">
  üíª Examples
 </a>
</li>

</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        0.1.2  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables _modules/spafe/utils/levinsondr and {'json_url': '_static/switcher.json', 'version_match': '0.1.2'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "_modules/spafe/utils/levinsondr.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "_modules/spafe/utils/levinsondr.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's dev variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "0.1.2") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/superkogito/" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><div class="profile-pic"><img src="../../../_static/logo.png" /></div>

<div class="bio-info">
  <div class="name">
  </div>
  <div class="focusareas">
    üîâ Spafe: Simplified Python Audio Features Extraction „Ä∞Ô∏è
  </div>
</div>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              


<!--  Bootstrap HTML  -->
<div id="lawmsg" class="alert alert-info alert-dismissible h5 fade show fixed-bottom" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    We use cookies on this website to distinguish you from other users.
    We use this data to improve our content experience and for targeted advertising.
    By continuing to use this website you consent to our use of cookies.
    For more information, please see our
    <a href="https://superkogito.github.io/policy/cookies_policy.html" target="_blank">Cookie Policy</a>.
</div>



              <div>
                
  <h1>Source code for spafe.utils.levinsondr</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">- Levinson module</span>
<span class="sd">- Original author: Thomas Cokelaer, 2011</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LEVINSON&quot;</span><span class="p">,</span> <span class="s2">&quot;rlevinson&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="LEVINSON"><a class="viewcode-back" href="../../../utils/levinsondr.html#spafe.utils.levinsondr.LEVINSON">[docs]</a><span class="k">def</span> <span class="nf">LEVINSON</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_singularity</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Levinson-Durbin recursion.</span>
<span class="sd">    Find the coefficients of a length(r)-1 order autoregressive linear process</span>

<span class="sd">    Args:</span>
<span class="sd">        r                (array) : autocorrelation sequence of length N + 1</span>
<span class="sd">                                   (first element being the zero-lag autocorrelation)</span>
<span class="sd">        order              (int) : requested order of the autoregressive coefficients.</span>
<span class="sd">                                   Default is N.</span>
<span class="sd">        allow_singularity (bool) : Other implementations may be True (e.g., octave)</span>
<span class="sd">                                   Default is False.</span>
<span class="sd">    Returns:</span>
<span class="sd">        * the `N+1` autoregressive coefficients :math:`A=(1, a_1...a_N)`</span>
<span class="sd">        * the prediction errors</span>
<span class="sd">        * the `N` reflections coefficients values</span>

<span class="sd">    Note:</span>

<span class="sd">        This algorithm solves the set of complex linear simultaneous equations</span>
<span class="sd">        using Levinson algorithm.</span>

<span class="sd">    .. math::</span>
<span class="sd">        \bold{T}_M \left( \begin{array}{c} 1 \\ \bold{a}_M \end{array} \right) =</span>
<span class="sd">        \left( \begin{array}{c} \rho_M \\ \bold{0}_M  \end{array} \right)</span>
<span class="sd">    where :math:`\bold{T}_M` is a Hermitian Toeplitz matrix with elements</span>
<span class="sd">    :math:`T_0, T_1, \dots ,T_M`.</span>

<span class="sd">    Note:</span>
<span class="sd">        Solving this equations by Gaussian elimination would</span>
<span class="sd">        require :math:`M^3` operations whereas the levinson algorithm</span>
<span class="sd">        requires :math:`M^2+M` additions and :math:`M^2+M` multiplications.</span>
<span class="sd">    This is equivalent to solve the following symmetric Toeplitz system of</span>
<span class="sd">    linear equations</span>

<span class="sd">    .. math::</span>
<span class="sd">        \left( \begin{array}{cccc}</span>
<span class="sd">        r_1 &amp; r_2^* &amp; \dots &amp; r_{n}^*\\</span>
<span class="sd">        r_2 &amp; r_1^* &amp; \dots &amp; r_{n-1}^*\\</span>
<span class="sd">        \dots &amp; \dots &amp; \dots &amp; \dots\\</span>
<span class="sd">        r_n &amp; \dots &amp; r_2 &amp; r_1 \end{array} \right)</span>
<span class="sd">        \left( \begin{array}{cccc}</span>
<span class="sd">        a_2\\</span>
<span class="sd">        a_3 \\</span>
<span class="sd">        \dots \\</span>
<span class="sd">        a_{N+1}  \end{array} \right)</span>
<span class="sd">        =</span>
<span class="sd">        \left( \begin{array}{cccc}</span>
<span class="sd">        -r_2\\</span>
<span class="sd">        -r_3 \\</span>
<span class="sd">        \dots \\</span>
<span class="sd">        -r_{N+1}  \end{array} \right)</span>
<span class="sd">    where :math:`r = (r_1  ... r_{N+1})` is the input autocorrelation vector, and</span>
<span class="sd">    :math:`r_i^*` denotes the complex conjugate of :math:`r_i`. The input r is typically</span>
<span class="sd">    a vector of autocorrelation coefficients where lag 0 is the first</span>
<span class="sd">    element :math:`r_1`.</span>
<span class="sd">    .. raw::python</span>
<span class="sd">        import numpy; from spectrum import LEVINSON</span>
<span class="sd">        T = numpy.array([3., -2+0.5j, .7-1j])</span>
<span class="sd">        a, e, k = LEVINSON(T)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#from numpy import isrealobj</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">&lt;=</span> <span class="n">M</span><span class="p">,</span> <span class="s1">&#39;order must be less than size of the input data&#39;</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">order</span>

    <span class="n">realdata</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isrealobj</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">realdata</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">T0</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="o">-</span><span class="n">save</span> <span class="o">/</span> <span class="n">P</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#save += sum([A[j]*T[k-j-1] for j in range(0,k)])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="n">save</span> <span class="o">=</span> <span class="n">save</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="o">-</span><span class="n">save</span> <span class="o">/</span> <span class="n">P</span>
        <span class="k">if</span> <span class="n">realdata</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">temp</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">P</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">allow_singularity</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;singular matrix&quot;</span><span class="p">)</span>
        <span class="n">A</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">ref</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>  <span class="c1"># save reflection coeff at each step</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">khalf</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">realdata</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">khalf</span><span class="p">):</span>
                <span class="n">kj</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">save</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">save</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">kj</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">kj</span><span class="p">:</span>
                    <span class="n">A</span><span class="p">[</span><span class="n">kj</span><span class="p">]</span> <span class="o">+=</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">save</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">khalf</span><span class="p">):</span>
                <span class="n">kj</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">save</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">save</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">kj</span><span class="p">]</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">kj</span><span class="p">:</span>
                    <span class="n">A</span><span class="p">[</span><span class="n">kj</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">kj</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">save</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">ref</span></div>


<div class="viewcode-block" id="rlevinson"><a class="viewcode-back" href="../../../utils/levinsondr.html#spafe.utils.levinsondr.rlevinson">[docs]</a><span class="k">def</span> <span class="nf">rlevinson</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">efinal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;computes the autocorrelation coefficients, R based</span>
<span class="sd">    on the prediction polynomial A and the final prediction error Efinal,</span>
<span class="sd">    using the stepdown algorithm.</span>
<span class="sd">    Works for real or complex data</span>
<span class="sd">    :param a:</span>
<span class="sd">    :param efinal:</span>

<span class="sd">    Returns:</span>
<span class="sd">        * R, the autocorrelation</span>
<span class="sd">        * U  prediction coefficient</span>
<span class="sd">        * kr reflection coefficients</span>
<span class="sd">        * e errors</span>
<span class="sd">    A should be a minimum phase polynomial and A(1) is assumed to be unity.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (P+1) by (P+1) upper triangular matrix, U, that holds the i&#39;th order</span>
<span class="sd">        prediction polynomials Ai, i=1:P, where P is the order of the input</span>
<span class="sd">        polynomial, A.</span>

<span class="sd">             [ 1  a1(1)*  a2(2)* ..... aP(P)  * ]</span>
<span class="sd">             [ 0  1       a2(1)* ..... aP(P-1)* ]</span>
<span class="sd">       U  =  [ .................................]</span>
<span class="sd">             [ 0  0       0      ..... 1        ]</span>

<span class="sd">        from which the i&#39;th order prediction polynomial can be extracted</span>
<span class="sd">        using Ai=U(i+1:-1:1,i+1)&#39;. The first row of U contains the</span>
<span class="sd">        conjugates of the reflection coefficients, and the K&#39;s may be</span>
<span class="sd">        extracted using, K=conj(U(1,2:end)).</span>

<span class="sd">    To do:</span>
<span class="sd">        remove the conjugate when data is real data, clean up the code test and doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">realdata</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isrealobj</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">a</span><span class="p">[</span>
        <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;First coefficient of the prediction polynomial must be unity&#39;</span>

    <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Polynomial should have at least two coefficients&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">realdata</span><span class="p">:</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>  <span class="c1"># This matrix will have the prediction</span>
        <span class="c1"># polynomials of orders 1:p</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">U</span><span class="p">[:,</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Prediction coefficients of order p</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># First we find the prediction coefficients of smaller orders and form the</span>
    <span class="c1"># Matrix U</span>

    <span class="c1"># Initialize the step down</span>

    <span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">efinal</span>  <span class="c1"># Prediction error of order p</span>

    <span class="c1"># Step down</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">levdown</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">U</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="p">)))</span>

    <span class="n">e0</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># % Because a[1]=1 (true polynomial)</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># % Prediction coefficient of zeroth order</span>
    <span class="n">kr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:])</span>  <span class="c1"># % The reflection coefficients</span>
    <span class="n">kr</span> <span class="o">=</span> <span class="n">kr</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  <span class="c1"># % To make it into a column vector</span>

    <span class="c1">#   % Once we have the matrix U and the prediction error at various orders, we can</span>
    <span class="c1">#  % use this information to find the autocorrelation coefficients.</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1">#% Initialize recursion</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">R0</span> <span class="o">=</span> <span class="n">e0</span>  <span class="c1"># To take care of the zero indexing problem</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">R0</span>  <span class="c1"># R[1]=-a1[1]*R[0]</span>

    <span class="c1"># Actual recursion</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">kr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>

    <span class="c1"># Include R(0) and make it a column vector. Note the dot transpose</span>

    <span class="c1"># R = [R0 R].&#39;;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kr</span><span class="p">,</span> <span class="n">e</span></div>


<span class="k">def</span> <span class="nf">levdown</span><span class="p">(</span><span class="n">anxt</span><span class="p">,</span> <span class="n">enxt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;One step backward Levinson recursion</span>
<span class="sd">    :param anxt:</span>
<span class="sd">    :param enxt:</span>
<span class="sd">    :return:</span>
<span class="sd">        * acur the P&#39;th order prediction polynomial based on the P+1&#39;th order prediction polynomial, anxt.</span>
<span class="sd">        * ecur the the P&#39;th order prediction error  based on the P+1&#39;th order prediction error, enxt.</span>
<span class="sd">    ..  * knxt the P+1&#39;th order reflection coefficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#% Some preliminaries first</span>
    <span class="c1"># if nargout&gt;=2 &amp; nargin&lt;2</span>
    <span class="c1">#    raise ValueError(&#39;Insufficient number of input arguments&#39;);</span>
    <span class="k">if</span> <span class="n">anxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;At least one of the reflection coefficients is equal to one.&#39;</span><span class="p">)</span>
    <span class="n">anxt</span> <span class="o">=</span> <span class="n">anxt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Drop the leading 1, it is not needed</span>
    <span class="c1">#  in the step down</span>

    <span class="c1"># Extract the k+1&#39;th reflection coefficient</span>
    <span class="n">knxt</span> <span class="o">=</span> <span class="n">anxt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">knxt</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;At least one of the reflection coefficients is equal to one.&#39;</span><span class="p">)</span>

    <span class="c1"># A Matrix formulation from Stoica is used to avoid looping</span>
    <span class="n">acur</span> <span class="o">=</span> <span class="p">(</span><span class="n">anxt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">knxt</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">anxt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">knxt</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ecur</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">enxt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ecur</span> <span class="o">=</span> <span class="n">enxt</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">knxt</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">knxt</span><span class="p">))</span>

    <span class="n">acur</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">acur</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">acur</span><span class="p">,</span> <span class="n">ecur</span>


<span class="k">def</span> <span class="nf">levup</span><span class="p">(</span><span class="n">acur</span><span class="p">,</span> <span class="n">knxt</span><span class="p">,</span> <span class="n">ecur</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    LEVUP  One step forward Levinson recursion</span>

<span class="sd">    Args:</span>
<span class="sd">        acur (array) :</span>
<span class="sd">        knxt (array) :</span>

<span class="sd">    Returns:</span>
<span class="sd">        anxt (array) : the P+1&#39;th order prediction polynomial based on the P&#39;th</span>
<span class="sd">                       order prediction polynomial, acur, and the P+1&#39;th order</span>
<span class="sd">                       reflection coefficient, Knxt.</span>
<span class="sd">        enxt (array) : the P+1&#39;th order prediction prediction error, based on the</span>
<span class="sd">                       P&#39;th order prediction error, ecur.</span>

<span class="sd">    References:</span>
<span class="sd">        P. Stoica R. Moses, Introduction to Spectral Analysis  Prentice Hall, N.J., 1997, Chapter 3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">acur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;At least one of the reflection coefficients is equal to one.&#39;</span><span class="p">)</span>
    <span class="n">acur</span> <span class="o">=</span> <span class="n">acur</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Drop the leading 1, it is not needed</span>

    <span class="c1"># Matrix formulation from Stoica is used to avoid looping</span>
    <span class="n">anxt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">acur</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">knxt</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">acur</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">enxt</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ecur</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># matlab version enxt = (1-knxt&#39;.*knxt)*ecur</span>
        <span class="n">enxt</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">knxt</span><span class="p">),</span> <span class="n">knxt</span><span class="p">))</span> <span class="o">*</span> <span class="n">ecur</span>

    <span class="n">anxt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">anxt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">anxt</span><span class="p">,</span> <span class="n">enxt</span>
</pre></div>

              </div>
              
<!-- Add a comment box underneath the page's content -->

              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
      <!-- Site footer -->
      <div class="container">
        <div class="row">
          <div class="col-xs-6 col-md-6">
            <ul class="footer-links">
              <li>
                    &copy; Copyright 2019-2022, Ayoub Malek.<br/>
                  This blog is created using <a href="http://sphinx-doc.org/">Sphinx</a> and the tools from <a href="https://executablebooks.org/en/latest/">The Executable Book Project</a>.<br/>
              </li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/privacy_policy.html">Privacy Policy</a></li>
              <li><a href="https://superkogito.github.io/policy/cookies_policy.html">Cookies policy</a></li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/terms_and_conditions.html">Terms and conditions</a></li>
              <li><a href="https://superkogito.github.io/policy/disclaimer.html">Disclaimer</a></li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/contribute.html">Contribute</a></li>
              <li><a href="https://superkogito.github.io/sitemap.xml">Sitemap</a></li>
            </ul>
          </div>

    </div>
  </footer>
  </body>
</html>